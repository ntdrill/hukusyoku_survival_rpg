# 05_MapEventSystem - マップ/イベントエージェント

## 役割
ステージ設計、NPC配置、イベント処理の実装を担当

---

## 担当タスク

### Phase 1: イベントシステム基盤（優先度: 最高）
- [ ] イベント管理クラスの設計
- [ ] イベントトリガーシステム
- [ ] 衝突判定の拡張（既存システムを活用）

### Phase 2: NPC会話システム（優先度: 最高）
- [ ] NPCエンティティクラス
- [ ] NPC配置システム
- [ ] 会話イベント処理
  - [ ] セリフデータ構造
  - [ ] 会話分岐
  - [ ] 好感度/相性システム（MP減少量に影響）
- [ ] NPC接触判定

### Phase 3: アイテムシステム（優先度: 高）
- [ ] アイテムエンティティクラス
- [ ] アイテム配置システム
- [ ] アイテム獲得処理
- [ ] クリア判定アイテム実装
- [ ] 石板獲得イベント
  - [ ] ステータス解放処理の連携

### Phase 4: おばけ出現システム（優先度: 高）
- [ ] おばけ配置システム
- [ ] 特定場所での出現制御
  - [ ] 職場の入り口
  - [ ] 発表者席の前
  - [ ] その他の重要ポイント
- [ ] おばけ接触判定
- [ ] 戦闘イベントへの遷移

### Phase 5: プロトタイプステージ作成（優先度: 最高）
- [ ] ステージマップデザイン
- [ ] タイル配置設計
- [ ] NPC配置（3〜5人）
- [ ] おばけ配置（1〜3体）
- [ ] アイテム配置
- [ ] クリア判定アイテム配置

### Phase 6: イベントスクリプト（優先度: 中）
- [ ] イベントスクリプトシステム
- [ ] カスタムイベント作成機能
- [ ] イベントフラグ管理

---

## 実装ファイル

1. `eventManager.js` - イベント管理メインクラス
2. `npcSystem.js` - NPC管理
3. `itemSystem.js` - アイテム管理
4. `ghostSpawner.js` - おばけ出現制御
5. `prototypeStage.js` - プロトタイプステージデータ
6. `dialogueData.js` - 会話データ
7. `eventScripts.js` - イベントスクリプト

---

## 依存関係

### 必要な情報（依存先）
- **01_GameDesigner**: ステージ設計、NPC設定、アイテム配置
- **02_StatusSystem**: ステータス変更メソッド
- **03_BattleSystem**: 戦闘開始メソッド
- 既存の `game.js` - マップシステム、衝突判定

### 提供する情報（依存元）
- **04_UIDesigner**: イベント発生通知
- **06_IntegrationTest**: ステージデータ

---

## プロトタイプステージ設計（提案/ドラフト）

### ステージコンセプト
**「職場復帰の朝」**

プレイヤーは自宅から職場まで移動し、上司に挨拶して復職初日を終える。

### マップレイアウト案

```
┌──────────────────────────────┐
│ 🏠スタート                   │
│    │                          │
│    │   👤NPC(同僚)            │
│    │                          │
│    ▼                          │
│  交差点──→ 👤NPC(友人)       │
│    │                          │
│    │   📖石板(MP解放)         │
│    │                          │
│    ▼                          │
│  駅前 👻不安のおばけ          │
│    │                          │
│    │   🍖回復アイテム         │
│    │                          │
│    ▼                          │
│  職場入口 👻緊張のおばけ      │
│    │                          │
│    │   👤NPC(先輩・苦手)     │
│    │                          │
│    ▼                          │
│  オフィス 🎯クリアアイテム    │
│           (上司の挨拶)        │
└──────────────────────────────┘
```

### イベントフロー
1. **自宅出発**: MP満タンでスタート
2. **同僚と会話**: MP -5 (普通の人)
3. **石板発見**: MP欄が「黒塗り」状態で表示開始
4. **友人と会話**: MP -2 (気の合う人)
5. **駅前で不安のおばけ**: 戦闘 or 回避
6. **回復アイテム**: MP +20
7. **職場入口で緊張のおばけ**: 戦闘必須（CBT技法使用）
8. **苦手な先輩と会話**: MP -15（表示されないので気づきにくい）
9. **上司に挨拶**: クリア！

---

## NPC設定例（提案/ドラフト）

```javascript
const NPCs = [
  {
    id: 'coworker_01',
    name: '同僚A',
    position: { x: 5, y: 3 },
    compatibility: 'normal', // normal, friendly, difficult
    mpCost: 5,
    dialogue: [
      'おはよう！久しぶりだね。',
      '元気そうで良かったよ。'
    ]
  },
  {
    id: 'friend_01',
    name: '親友B',
    position: { x: 12, y: 5 },
    compatibility: 'friendly',
    mpCost: 2,
    dialogue: [
      'やあ！調子どう？',
      '無理しないでね。'
    ]
  },
  {
    id: 'senior_01',
    name: '先輩C（苦手）',
    position: { x: 10, y: 12 },
    compatibility: 'difficult',
    mpCost: 15,
    dialogue: [
      'あ、復帰したんだ。',
      '遅れないようにね。'
    ]
  }
];
```

---

## 作業ログ

### 2025/10/30
- フォルダ作成
- README.md作成
- プロトタイプステージの提案設計

---

**次のアクション**: イベントシステム基盤の実装、既存システムとの統合

